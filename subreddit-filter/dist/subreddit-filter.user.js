// ==UserScript==
// @name            Subreddit Filter 
// @namespace       https://github.com/stevehartwell
// @description     Filter subreddits from your reddit feed.
// @updateURL       https://github.com/stevehartwell/UserScripts/subreddit-filter/dist/subreddit-filter.user.js
// @homepageURL     https://github.com/stevehartwell/UserScripts/subreddit-filter
// @supportURL      https://github.com/stevehartwell/UserScripts/issues
// @version         1.0.74
// @author          Steve Hartwell
// @match           https://www.reddit.com/
// @match           https://www.reddit.com/best*
// @match           https://www.reddit.com/hot*
// @match           https://www.reddit.com/new*
// @match           https://www.reddit.com/top*
// @match           https://www.reddit.com/rising*
// @match           https://www.reddit.com/r/all*
// @match           https://www.reddit.com/r/popular*
// @noframes
// @run-at          document-end
// @grant           GM.getValue
// @grant           GM.setValue
// ==/UserScript==
!function(){function e(e){return e&&e.__esModule?e.default:e}class t{static async loadFromStorage(e){const i=[e.load("hiddenSubreddits",[])];return Promise.all(i).then((i=>{const n=new t(e);let o=i[0];return"string"==typeof o&&(o=JSON.parse(o)),n.hiddenSubreddits=o,n}))}toJSON(){return{hiddenSubreddits:this.hiddenSubreddits}}get hiddenSubreddits(){return Array.from(this._hiddenSubreddits).sort(((e,t)=>e.localeCompare(t,void 0,{sensitivity:"case"})))}set hiddenSubreddits(e){this._hiddenSubreddits=new Set(e)}isHidden(e){return this._hiddenSubreddits.has(e)}filter(e,t){var i;if(this.isHidden(e)==t)return!1;t?this._hiddenSubreddits.add(e):this._hiddenSubreddits.delete(e);const n=[...this._hiddenSubreddits];return null===(i=this._store)||void 0===i||i.save("hiddenSubreddits",n),!0}constructor(e){var t,i,n;t=this,i="_hiddenSubreddits",n=new Set,i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,this._store=e}}var i=function(e,t,...i){if("function"==typeof e)return e(t,i);const n=document.createElement(e);for(const[e,i]of Object.entries(t||{}))if("function"==typeof i||"object"==typeof i&&"handleEvent"in i){const t=e.startsWith("on")?e.slice(2):e;n.addEventListener(t,i)}else e in n?n[e]=i:n.setAttribute(e,i);return n.append(...i),n};class n{filter(e,t){this._config.filter(e,t)&&t&&this._filteredSubreddits.insertBefore(o(e),this._filteredSubreddits.firstChild)}_reload(){this._filteredSubreddits.replaceChildren(),this._filteredSubreddits.replaceChildren(...this._config.hiddenSubreddits.map((e=>o(e))))}_createConfigPane(){return i("div",{className:"subfilt-config-pane"},i("header",{},i("h1",{},"Subreddit Filters")),this._filteredSubreddits,i("footer",{},i("button",{type:"button"},i("label",{},"importâ€¦",i("input",{type:"file",onchange:e=>this._importConfig(e)}))),i("button",{type:"button",onclick:e=>this._exportConfig(e)},i("label",{},"exportâ€¦",i("a")))))}_importConfig(e){let t=e.target;const i=new FileReader;i.onloadend=()=>{console.log(i.error,i.result)},i.readAsText(t.files[0])}_exportConfig(e){let t=e.target;if("LABEL"!==t.tagName)return;const i=t.querySelector("a");i&&(i.download="subreddit-filters.json",i.href=URL.createObjectURL(new Blob([JSON.stringify(this._config)],{type:"application/json"})),i.click())}constructor(t){this._config=new Proxy(t,{set:(e,t,i)=>!1}),document.head.appendChild(i("style",{textContent:e(":root{color-scheme:light dark}.subfilt-config{z-index:100;position:fixed;top:0;right:0}#subfilt-config-checkbox{display:none}.subfilt-config-backdrop{width:100%;height:100%;background:rgba(0,0,0,.5);display:none;position:fixed;top:0;left:0}#subfilt-config-checkbox:checked~.subfilt-config-backdrop{display:block}.subfilt-config-toggle{all:revert;z-index:200;width:20px;height:20px;cursor:pointer;transform-origin:50%;background:orange url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2220%22%20height%3D%2220%22%3E%3Cg%20style%3D%22fill%3Ared%3Bstroke%3Anone%22%3E%3Cpath%20d%3D%22M0%208h20v4H0z%22%2F%3E%3Cpath%20d%3D%22M8%200h4v20H8z%22%2F%3E%3C%2Fg%3E%3C%2Fsvg%3E) 50% no-repeat;transition:transform .5s;display:block;position:fixed;top:8px;right:8px}#subfilt-config-checkbox~.subfilt-config-toggle{transform:rotate(0)}#subfilt-config-checkbox:checked~.subfilt-config-toggle{transform:rotate(45deg)}.subfilt-config-pane{all:revert;--subfilt-config-width:240px;width:var(--subfilt-config-width);max-height:calc(100% - 40px);background-color:canvas;font:caption;transform:translate(var(--subfilt-config-width),0);background-clip:padding-box;border:2px solid gray;flex-flow:column;margin:20px 0;padding:4px;transition:transform .5s;display:flex;position:fixed;top:0;right:0;box-sizing:border-box!important}#subfilt-config-checkbox:checked~.subfilt-config-pane{transform:translate(-20px)}.subfilt-config-pane header h1{text-align:center;margin:0;padding:0;font-size:larger}.subfilt-config-pane hr{width:96%}.subfilt-config-pane label{all:revert;white-space:nowrap;text-overflow:ellipsis;vertical-align:middle;display:list-item;overflow:hidden}.subfilt-config-pane input[type=checkbox]{margin-right:4px}.subfilt-config-pane ul{all:revert;border-top:1px solid gray;border-bottom:1px solid gray;margin:4px 0;padding:4px 0;list-style:none;overflow-y:auto}.subfilt-config-pane footer{all:revert;flex-flow:row;justify-content:space-around;display:flex}.subfilt-config-pane footer button{all:revert;min-height:20px}.subfilt-config-pane footer button label :first-child{display:none}")})),this._filteredSubreddits=i("ul",{onchange:e=>{var t;const i=e.target;if(!(null==i?void 0:i.matches("input[type=checkbox]")))return void console.info(`?? event on ${null==i?void 0:i.nodeName}`);const n=null==i||null===(t=i.parentElement)||void 0===t?void 0:t.textContent;this.filter(n,i.checked)}});const n=function(){const e="subfilt-config-checkbox";return i("aside",{className:"subfilt-config"},i("input",{type:"checkbox",id:e}),i("label",{className:"subfilt-config-backdrop",htmlFor:e}),i("label",{className:"subfilt-config-toggle",htmlFor:e}))}();n.appendChild(this._createConfigPane()),document.body.append(n),this._reload()}}function o(e){return i("li",{},i("label",{},i("input",{type:"checkbox",checked:!0}),e))}class r{run(){const e=()=>{console.info(this,document.readyState),this._applyFilters(document.body),this._addedNodesObserver.observe(document.body,{childList:!0,subtree:!0})};"complete"===document.readyState?e():window.addEventListener("load",e)}_applyFilters(e){if("querySelectorAll"in e)for(const t of e.querySelectorAll(".scrollerItem"))this._applyFilter(t)}_applyFilter(e){if("none"==e.style.display)return;const t=e.querySelector("[data-click-id=subreddit]");if(!t)return;const i=t.pathname;if(this._config.isHidden(i))return void(e.style.display="none");const n=t.parentNode;n&&!n.querySelector(".subfilt-hideButton")&&n.appendChild(this._makeFilterButton(i))}_makeFilterButton(e){let t=document.createElement("button");return t.classList.add("subfilt-hideButton"),t.innerHTML="ðŸš«",t.title="hide this subreddit from feed",t.addEventListener("click",(()=>{this._hideSubreddit(e)})),t}_hideSubreddit(e){this._configView.filter(e,!0),this._applyFilters(document.body)}constructor(e){this._config=e,this._configView=new n(e),this._addedNodesObserver=new MutationObserver((e=>{for(const t of e)for(const e of t.addedNodes)this._applyFilters(e)}))}}class s{async load(e,t){return GM.getValue(e,t).then((e=>e))}async save(e,t){try{return GM.setValue(e,t)}catch(i){return GM.setValue(e,JSON.stringify(t))}}}(async()=>{const e=new s,i=await t.loadFromStorage(e);new r(i).run()})()}();